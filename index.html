<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base href="/">
  <title>AnÃ¡lise de Clientes</title>
  <style>
    /* ... seu CSS permanece idÃªntico ... */
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š AnÃ¡lise de Clientes</h1>
    
    <div class="botoes">
      <button onclick="carregarImagem('clusterizacao')">ğŸ” ClusterizaÃ§Ã£o</button>
      <button onclick="carregarImagem('clv')">ğŸ’° CLV</button>
      <button onclick="carregarImagem('conjoint')">ğŸ“ˆ Conjoint</button>
      <button onclick="carregarImagem('previsao')">ğŸ”® PrevisÃ£o</button>
      <button onclick="carregarCSV()">ğŸ“‚ Carregar Dados</button>
    </div>

    <div class="imagem-container" id="imagemContainer">
      <div class="status">Selecione uma visualizaÃ§Ã£o acima</div>
    </div>

    <div class="tabela-container" id="tabelaContainer">
      <div class="status">Clique em "Carregar Dados" para ver as informaÃ§Ãµes</div>
    </div>
  </div>

  <script>
    // ConfiguraÃ§Ã£o de caminhos absolutos
    const BASE_URL = window.location.origin;

    async function carregarCSV() {
      const container = document.getElementById('tabelaContainer');
      try {
        container.innerHTML = '<div class="status">Carregando dados.</div>';

        // URL absoluta com cache busting (alterado para clientes.csv)
        const csvUrl = `${BASE_URL}/clientes.csv?t=${Date.now()}`;
        const response = await fetch(csvUrl);
        if (!response.ok) {
          throw new Error(`Erro ${response.status}: ${response.statusText}`);
        }

        // DecodificaÃ§Ã£o segura
        const buffer = await response.arrayBuffer();
        const decoder = new TextDecoder('utf-8');
        const csvData = decoder.decode(buffer).replace(/^\uFEFF/, '');

        // Processamento do CSV
        const linhas = csvData.split(/\r?\n/).filter(line => line.trim());
        if (linhas.length < 2) throw new Error('CSV invÃ¡lido');

        const headers = linhas[0].split(',').map(h => h.trim());
        const expectedHeaders = [
          'cliente_id', 'idade', 'renda_anual', 'frequencia_compras',
          'valor_medio_compra', 'preferencia_frete_gratis',
          'satisfacao_qualidade', 'total_gasto'
        ];
        if (!arraysIguais(headers, expectedHeaders)) {
          throw new Error('CabeÃ§alhos do CSV nÃ£o correspondem');
        }

        // ConstruÃ§Ã£o da tabela
        const table = document.createElement('table');
        const thead = table.createTHead();
        const headerRow = thead.insertRow();
        headers.forEach(header => {
          const th = document.createElement('th');
          th.textContent = header;
          headerRow.appendChild(th);
        });

        const tbody = table.createTBody();
        for (let i = 1; i < linhas.length; i++) {
          const cells = linhas[i].split(',').map(c => c.trim());
          if (cells.length !== headers.length) continue;
          const row = tbody.insertRow();
          cells.forEach((cell, idx) => {
            const td = row.insertCell();
            td.innerHTML = formatarCelula(cell, headers[idx]);
          });
        }

        container.innerHTML = '';
        container.appendChild(table);

      } catch (error) {
        console.error('Erro:', error);
        container.innerHTML = `
          <div class="erro">
            <strong>Erro ao carregar dados:</strong> ${error.message}
            <br><br>
            <button onclick="location.reload()">â†» Tentar novamente</button>
          </div>
        `;
      }
    }

    // ... o restante das funÃ§Ãµes formatarCelula, arraysIguais, carregarImagem e handleImageError permanece inalterado ...
  </script>
</body>
</html>
