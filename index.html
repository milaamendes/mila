<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>An√°lise de Clientes</title>
  <style>
    /* Container centralizado */
    .container {
      max-width: 960px;
      margin: 40px auto;
      padding: 0 20px;
      text-align: center;
      font-family: Arial, sans-serif;
      color: #333;
    }

    /* T√≠tulo maior */
    h1 {
      font-size: 2.5rem;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    /* Linha de bot√µes */
    .botoes {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 30px;
    }

    .botoes button {
      flex: 1;
      min-width: 140px;
      padding: 12px 20px;
      background-color: #1e90ff;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background-color .2s;
    }
    .botoes button:hover {
      background-color: #1c86ee;
    }

    /* Container do gr√°fico */
    .imagem-container {
      display: flex;
      justify-content: center;
      margin-bottom: 40px;
      min-height: 300px;    /* reserva espa√ßo antes de carregar */
    }
    .imagem-container .status {
      font-size: 1.1rem;
      color: #666;
      align-self: center;
    }
    .imagem-container img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* Container da tabela */
    .tabela-container {
      margin-bottom: 40px;
    }
    .tabela-container .status {
      font-size: 1.1rem;
      color: #666;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f5f5f5;
    }
    td.num {
      text-align: right;
    }

    /* Mensagem de erro */
    .erro {
      color: #a00;
      font-size: 1rem;
    }
    .erro button {
      margin-top: 12px;
      padding: 6px 12px;
      border: 1px solid #a00;
      background: none;
      color: #a00;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä An√°lise de Clientes</h1>

    <div class="botoes">
      <button onclick="carregarImagem('clusterizacao')">üîç Clusteriza√ß√£o</button>
      <button onclick="carregarImagem('clv')">üí∞ CLV</button>
      <button onclick="carregarImagem('conjoint')">üìà Conjoint</button>
      <button onclick="carregarImagem('previsao')">üîÆ Previs√£o</button>
      <button onclick="carregarCSV()">üìÇ Carregar Dados</button>
    </div>

    <div class="imagem-container" id="imagemContainer">
      <div class="status">Selecione uma visualiza√ß√£o acima</div>
    </div>

    <div class="tabela-container" id="tabelaContainer">
      <div class="status">Clique em "Carregar Dados" para ver as informa√ß√µes</div>
    </div>
  </div>

  <script>
    const BASE = window.location.origin;

    function carregarImagem(nome) {
      const c = document.getElementById('imagemContainer');
      c.innerHTML = '<div class="status">Carregando imagem...</div>';
      const img = new Image();
      img.src = `${BASE}/${nome}.png?t=${Date.now()}`;
      img.onload = () => {
        c.innerHTML = '';
        c.appendChild(img);
      };
      img.onerror = () => {
        c.innerHTML = `
          <div class="erro">
            <strong>Erro ao carregar imagem.</strong><br>
            <button onclick="carregarImagem('${nome}')">‚Üª Tentar novamente</button>
          </div>`;
      };
    }

    async function carregarCSV() {
      const c = document.getElementById('tabelaContainer');
      c.innerHTML = '<div class="status">Carregando dados...</div>';

      try {
        const res = await fetch(`${BASE}/clientes.csv?t=${Date.now()}`);
        if (!res.ok) throw new Error(res.statusText);

        const buf = await res.arrayBuffer();
        const text = new TextDecoder('utf-8').decode(buf).replace(/^\uFEFF/, '');
        const linhas = text.trim().split(/\r?\n/);
        const headers = linhas[0].split(',').map(h => h.trim());
        const expected = ['cliente_id','idade','renda_anual','frequencia_compras','valor_medio_compra','preferencia_frete_gratis','satisfacao_qualidade','total_gasto'];
        if (JSON.stringify(headers) !== JSON.stringify(expected)) {
          throw new Error('Cabe√ßalhos inesperados no CSV');
        }

        // monta tabela
        const table = document.createElement('table');
        const thead = table.createTHead();
        const hr = thead.insertRow();
        headers.forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          hr.appendChild(th);
        });
        const tbody = table.createTBody();
        linhas.slice(1).forEach(ln => {
          const vals = ln.split(',').map(v => v.trim());
          if (vals.length !== headers.length) return;
          const row = tbody.insertRow();
          vals.forEach((v, i) => {
            const td = row.insertCell();
            td.classList.add(!isNaN(v) ? 'num' : '');
            td.textContent = v;
          });
        });

        c.innerHTML = '';
        c.appendChild(table);
      } catch (err) {
        c.innerHTML = `
          <div class="erro">
            <strong>Erro ao carregar dados:</strong> ${err.message}
          </div>`;
      }
    }
  </script>
</body>
</html>
